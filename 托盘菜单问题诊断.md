# æ‰˜ç›˜èœå•ç‚¹å‡»é—®é¢˜è¯Šæ–­

## é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šï¼šæ‰˜ç›˜ç¨‹åºå¯ä»¥å¯åŠ¨ï¼Œä½†ç‚¹å‡»èœå•ä¸­çš„åŠŸèƒ½æŒ‰é’®æ²¡æœ‰å‡ºç°ç”»é¢å¼¹çª—ã€‚

## å·²å®Œæˆçš„è¯Šæ–­å’Œä¿®å¤

### âœ… 1. æ·»åŠ è¯¦ç»†è°ƒè¯•ä¿¡æ¯

å·²åœ¨ `run_with_tray.py` ä¸­æ·»åŠ äº†å®Œæ•´çš„è°ƒè¯•è¾“å‡ºï¼š

**èœå•ç‚¹å‡»è°ƒè¯•ï¼š**
- `open_single_window()` - æ‰“å°"æ”¶åˆ°æ‰“å¼€å•æ‘„åƒå¤´çª—å£è¯·æ±‚"
- `open_dual_window()` - æ‰“å°"æ”¶åˆ°æ‰“å¼€åŒæ‘„åƒå¤´çª—å£è¯·æ±‚"

**çª—å£æ‰“å¼€è°ƒè¯•ï¼š**
- `open_window()` - æ‰“å°å‚æ•°ä¿¡æ¯
- çº¿ç¨‹åˆ›å»ºå’Œå¯åŠ¨çŠ¶æ€
- åº”ç”¨åˆå§‹åŒ–è¿›åº¦
- å¯¼å…¥å’Œå®ä¾‹åŒ–çŠ¶æ€

**çº¿ç¨‹è¾“å‡ºè°ƒè¯•ï¼š**
- æ‰€æœ‰printè¯­å¥éƒ½æ·»åŠ äº† `sys.stdout.flush()`
- ç¡®ä¿è¾“å‡ºç«‹å³æ˜¾ç¤º

### âœ… 2. æµ‹è¯•ç»“æœ

**æµ‹è¯•1ï¼šèœå•å‡½æ•°**
```bash
.venv\Scripts\python.exe test_tray_menu.py
```
ç»“æœï¼šâœ… èœå•å‡½æ•°æ­£å¸¸è°ƒç”¨ï¼Œçº¿ç¨‹æ­£ç¡®å¯åŠ¨

**æµ‹è¯•2ï¼šå¯¼å…¥æµ‹è¯•**
```bash
.venv\Scripts\python.exe -c "from run_with_rvm import AIPoseMatchRVMDebug; print('å¯¼å…¥æˆåŠŸ')"
```
ç»“æœï¼šâœ… å¯¼å…¥æ­£å¸¸

### ğŸ” å¾…æµ‹è¯•

éœ€è¦å®é™…è¿è¡Œæ‰˜ç›˜ç¨‹åºï¼Œç‚¹å‡»èœå•é¡¹ï¼ŒæŸ¥çœ‹å®Œæ•´çš„è°ƒè¯•è¾“å‡ºã€‚

## å¯èƒ½çš„é—®é¢˜

### 1. æ§åˆ¶å°è¾“å‡ºè¢«éšè—
- æ‰˜ç›˜ç¨‹åºå¯åŠ¨åï¼Œæ§åˆ¶å°çª—å£å¯èƒ½æœ€å°åŒ–
- è°ƒè¯•ä¿¡æ¯å¯èƒ½æ²¡æœ‰æ˜¾ç¤º

### 2. çª—å£åˆ›å»ºæˆåŠŸä½†è¢«éšè—
- OpenCVçª—å£å¯èƒ½åˆ›å»ºåœ¨å±å¹•å¤–
- çª—å£å¯èƒ½è¢«å…¶ä»–çª—å£é®æŒ¡

### 3. è™šæ‹Ÿç¯å¢ƒè·¯å¾„é—®é¢˜
- å­è¿›ç¨‹å¯èƒ½æ— æ³•æ‰¾åˆ°æ­£ç¡®çš„æ¨¡å—è·¯å¾„
- éœ€è¦ç¡®ä¿sys.pathæ­£ç¡®

## ä¸‹ä¸€æ­¥æ“ä½œ

è¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æ‰˜ç›˜ï¼š

```bash
.venv\Scripts\python.exe run_with_tray.py
```

ç„¶åï¼š
1. å³é”®ç‚¹å‡»æ‰˜ç›˜å›¾æ ‡
2. é€‰æ‹©"æ‰“å¼€å•æ‘„åƒå¤´çª—å£"
3. **æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º**ï¼Œæ‰¾åˆ°æ‰€æœ‰ `[DEBUG]` å¼€å¤´çš„æ¶ˆæ¯
4. å°†å®Œæ•´çš„æ§åˆ¶å°è¾“å‡ºå‘é€ç»™æˆ‘

## å¤‡é€‰æµ‹è¯•æ–¹æ¡ˆ

å¦‚æœæ§åˆ¶å°çª—å£è¢«éšè—æˆ–éš¾ä»¥æŸ¥çœ‹ï¼Œå¯ä»¥ï¼š

### æ–¹æ¡ˆ1ï¼šè¾“å‡ºåˆ°æ–‡ä»¶

ä¿®æ”¹å¯åŠ¨è„šæœ¬ï¼Œå°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ï¼š

```bash
.venv\Scripts\python.exe run_with_tray.py > tray_output.log 2>&1
```

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨è¯¦ç»†è°ƒè¯•æ¨¡å¼

åˆ›å»ºä¸€ä¸ªæ–°çš„æµ‹è¯•å¯åŠ¨è„šæœ¬ï¼Œä¸“é—¨ç”¨äºè¯Šæ–­ï¼š

```python
# test_tray_with_logging.py
import sys
import logging

# è®¾ç½®è¯¦ç»†çš„æ—¥å¿—
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('tray_debug.log'),
        logging.StreamHandler(sys.stdout)
    ]
)

from run_with_tray import TrayApp
app = TrayApp()
app.run()
```

## é¢„æœŸè¾“å‡º

æ­£å¸¸æƒ…å†µä¸‹çš„é¢„æœŸè¾“å‡ºï¼š

```
[DEBUG] æ”¶åˆ°æ‰“å¼€å•æ‘„åƒå¤´çª—å£è¯·æ±‚
[DEBUG] open_windowè¢«è°ƒç”¨: dual_mode=False, backend_mode=False, show_window=True
[DEBUG] åˆ›å»ºçº¿ç¨‹...
[DEBUG] çº¿ç¨‹å·²å¯åŠ¨ï¼Œçº¿ç¨‹ID: xxxxx, å­˜æ´»: True
[DEBUG] run_appçº¿ç¨‹å¼€å§‹: dual_mode=False, backend_mode=False, show_window=True
[DEBUG] å¯åŠ¨å•æ‘„åƒå¤´æ¨¡å¼
[DEBUG] å¯¼å…¥AIPoseMatchRVMDebug...
[RVM Official] ...
[DEBUG] å¯¼å…¥æˆåŠŸ
[DEBUG] åˆ›å»ºAIPoseMatchRVMDebugå®ä¾‹...
[DEBUG] å®ä¾‹åˆ›å»ºæˆåŠŸï¼Œè°ƒç”¨app.run()
======================================================================
AI Pose Match - RVMå¢å¼ºç‰ˆå¯åŠ¨ç¨‹åº
======================================================================
```

å¦‚æœçœ‹åˆ°é”™è¯¯ï¼Œåº”è¯¥æ˜¯ï¼š
```
[ERROR] å¯åŠ¨åº”ç”¨å¤±è´¥: xxxxx
Traceback (most recent call last):
...
```

## æ–‡ä»¶åˆ—è¡¨

å·²åˆ›å»º/ä¿®æ”¹çš„æµ‹è¯•æ–‡ä»¶ï¼š
- `test_tray_menu.py` - èœå•åŠŸèƒ½æµ‹è¯•
- `test_tray_thread.py` - çº¿ç¨‹æµ‹è¯•
- `test_tray_simple.py` - ç®€åŒ–æµ‹è¯•
- `run_with_tray.py` - å·²æ·»åŠ è¯¦ç»†è°ƒè¯•ä¿¡æ¯

## è”ç³»æ–¹å¼

è¯·æä¾›å®Œæ•´çš„æ§åˆ¶å°è¾“å‡ºï¼Œç‰¹åˆ«æ˜¯ï¼š
1. ç‚¹å‡»èœå•åçš„æ‰€æœ‰ `[DEBUG]` æ¶ˆæ¯
2. ä»»ä½• `[ERROR]` æ¶ˆæ¯
3. Tracebackä¿¡æ¯

